<h2>
  <LinkTo @route="addons.show" @model={{addon.name}} class="test-addon-link">
    {{addon.name}}
    {{#if addon.isOfficial}}
      <OfficialIcon @class="test-official-icon" />
    {{/if}}
    {{#if addon.isCliDependency}}
      <DependencyIcon @class="test-cli-dep-icon" />
    {{/if}}
  </LinkTo>
</h2>

<section class="addon-info">
  <div class="test-last-updated">
    <b>{{addon.latestAddonVersion.version}}</b> from <RelativeTime @date={{addon.latestVersionDate}} />
  </div>
  <div class="test-description"><b>description</b> {{addon.description}}</div>
  {{#if addon.demoUrl}}
    <div class="test-addon-demo-url">
      <b>demo</b> <a href={{addon.demoUrl}}>{{addon.demoUrl}}</a>
    </div>
  {{/if}}
  <div class="test-addon-package-url">
    <b>package</b> <a href={{addon.npmUrl}}>{{addon.npmUrl}}</a>
  </div>
  <div class="test-addon-license">
    <b>license</b> {{addon.license}}
  </div>
  <div>
    <b>npm keywords</b>
    {{#each addon.keywords as |keyword|}}
      <CommaSeparated @list={{addon.keywords}} @item={{keyword}} as |value separator|>
        {{value.keyword}}{{separator}}
      </CommaSeparated>
    {{/each}}
  </div>
  {{#if addon.ranking}}
    <span><LinkTo @route="addons.top">Ranks #{{addon.ranking}} of the top 100 addons!</LinkTo></span>
  {{/if}}
</section>

<section>
  <ScoreDisplay @addon={{addon}} as |val|>
    Score <b class="test-score">{{val}}</b>
  </ScoreDisplay>
</section>

<section>
  <label>Repo URL</label>
  {{#if addon.repositoryUrl}}
    <a href={{addon.repositoryUrl}} target="repo" class="test-repo-url">{{addon.repositoryUrl}}</a>
  {{else}}
    <em>Missing</em>
  {{/if}}
  <a href="https://www.google.com/search?q=%22{{addon.name}}%22" target="_blank" rel="noopener" title="Search Google">&nbsp;{{svg-icon "google"}}</a>
  |
  <a href="https://github.com/search?q=%22{{addon.name}}%22" target="_blank" rel="noopener" title="Search GitHub">{{svg-icon "github"}}</a>
  <ToggleSwitch @label={{if addon.hasInvalidGithubRepo "Has invalid Repo URL" "Has valid Repo URL"}} @isChecked={{not addon.hasInvalidGithubRepo}} @onToggle={{action updateInvalidRepoFlag}} @name="repo" @class="test-toggle-repo-validity" />
</section>

<section class="toggles">
  <ToggleSwitch @label={{if addon.isWip "Is a WIP" "Not a WIP"}} @isChecked={{not addon.isWip}} @onToggle={{action updateIsWipFlag}} @name="wip" @class="test-toggle-is-wip" />
  <ToggleSwitch @label={{if addon.isDeprecated "Deprecated" "Active"}} @isChecked={{not addon.isDeprecated}} @onToggle={{action updateIsDeprecatedFlag}} @name="deprecated" @class="test-toggle-is-deprecated" />
  <ToggleSwitch @label={{if addon.isHidden "Hidden" "Visible"}} @isChecked={{not addon.isHidden}} @onToggle={{action updateIsHiddenFlag}} @class="hidden-toggle test-toggle-is-hidden" @name="hidden" />
  <ToggleSwitch @label="Is Official?" @isChecked={{addon.isOfficial}} @onToggle={{action (mut addon.isOfficial)}} @name="official" @class="test-toggle-is-official" />
  <ToggleSwitch @label="Is CLI Dependency?" @isChecked={{addon.isCliDependency}} @onToggle={{action (mut addon.isCliDependency)}} @name="cli-dep" @class="test-toggle-is-cli-dep" />
  <ToggleSwitch @label="Extends Ember?" @isChecked={{addon.extendsEmber}} @onToggle={{action (mut addon.extendsEmber)}} @name="extends-ember" @class="test-toggle-extends-ember" />
  <ToggleSwitch @label="Extends Ember CLI?" @isChecked={{addon.extendsEmberCli}} @onToggle={{action (mut addon.extendsEmberCli)}} @name="extends-ember-cli" @class="test-toggle-extends-ember-cli" />
  <ToggleSwitch @label="Is Monorepo?" @isChecked={{addon.isMonorepo}} @onToggle={{action (mut addon.isMonorepo)}} @name="is-monorepo" @class="test-toggle-is-monorepo" />
</section>

<section class="with-default-styling">
  <label>Override Repo URL</label>
  <Input @value={{addon.overrideRepositoryUrl}} class="test-override-repo-url-input" @autocomplete="off" />
</section>

<section class="with-default-styling">
  <label>Note</label>
  <Textarea @value={{addon.note}} @rows="3" class="note-input test-note-input" @autocomplete="off" />
</section>

<section>
  <CategoryChooser @categories={{categories}} @addon={{addon}} @onchange={{action (mut addon.categories)}} />
</section>

<section>
  {{#if saveAddon.isRunning}}
    <button class="button" disabled>Saving...</button>
  {{else}}
    <button class="button test-save-addon" {{action (perform saveAddon)}}>Save</button>
  {{/if}}
  <div class="note">Last saved {{moment-from-now addon.updatedAt allowEmpty=true}} ({{moment-format addon.updatedAt "MMMM DD, YYYY h:mm:ss" allowEmpty=true}})</div>
</section>

<section class="latest-review">
  <h5 class="header">Latest Review</h5>
  <div class="contents">
    {{#if addon.latestReview}}
      {{#if (not-eq addon.latestReview.version.version addon.latestAddonVersion.version)}}
        <em class="test-review-new-version-warning">{{svg-icon "new-releases"}} New versions of this addon have been released since this review was undertaken.</em>
      {{/if}}
      <AddonReview @review={{addon.latestReview}} />
      {{#if renewLatestReview.isIdle}}
        <button {{action (perform renewLatestReview)}} class="button test-renew-latest-review">Renew Review</button>
      {{else}}
        <button disabled class="button">Saving...</button>
      {{/if}}
      {{#if recentlyRenewed}}
        <b>Saved!</b>
      {{/if}}
    {{else}}
      <p class="no-review test-no-review">This addon has not yet been reviewed.</p>
    {{/if}}
    <hr>
    <section class="with-default-styling">
      <AdminAddonReviewForm @addon={{addon}} />
    </section>
  </div>
</section>

<section>
  {{#if addon.readme}}
    {{#unless addon.hasInvalidGithubRepo}}
      <section class="readme">
        <p class="header">README.md</p>
        <p class="test-addon-readme contents">
          <MarkdownToSanitizedHtml @markdown={{addon.readme.contents}} @tables={{true}} @ghCodeBlocks={{true}} @tasklists={{true}} @simplifiedAutoLink={{true}} />
        </p>
      </section>
    {{/unless}}
  {{/if}}
</section>
